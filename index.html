<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>ç®€æ˜“èŠå¤©å®¤</title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }
      .window {
        width: 500px;
        height: 350px;
        border: 2px solid #6d6565;
				border-radius: 6px;
      }
    </style>
  </head>

  <body>
    <!-- <button type="button" onclick="clickFun()">click</button> -->
    <h1>æ¬¢è¿æ¥åˆ°èŠå¤©å®¤</h1>
    <div class="window"></div>
    <div id="usernum"></div>
    <form id="message-form" action="#">
      <textarea id="message" rows="4" cols="30"></textarea>
      <div>
        <input type="submit" value="å‘é€æ¶ˆæ¯" id="submit" />
      </div>
    </form>
    <script src="http://10.3.108.54:3001/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
    </script>
  </body>

  <script>
    //æŒ‡ç¤ºæµè§ˆå™¨è¿æ¥ä½äºhttp://10.3.108.54:3001çš„SocketIOæœåŠ¡å™¨
    var socket = io.connect('http://10.3.108.54:3001');
    //ç›‘å¬æœåŠ¡å™¨å¹¿æ’­çš„usersnumäº‹ä»¶
    socket.on('usernum', function (data) {
      console.log("ğŸš€ ~ file: index.html ~ line 47 ~ data", data)
      $('#usernum').html('åœ¨çº¿äººæ•°:' + data.number);
    });
    socket.on('currentTime', (data) => {
      $('form').after('<p>' + data + '</p>');
    });
    var message = document.getElementById('message');
    var submit = document.getElementById('submit');
    $('#message').keydown(function (e) {
      // å½“ keyCode æ˜¯13æ—¶,æ˜¯å›è½¦æ“ä½œ
      if (e.keyCode == 13) {
        // ç¼–å†™ä¸šåŠ¡ä»£ç ...
        e.preventDefault();
        keydown();
        // å–æ¶ˆä¹‹å‰çš„keydownäº‹ä»¶
      }
    });
    $(message.form).submit(keydown);
    //å®¢æˆ·ç«¯ç›‘å¬push messageäº‹ä»¶,è¿™æ˜¯æœåŠ¡å™¨ç«¯å¹¿æ’­çš„,å¹¿æ’­ç»™é™¤äº†å‘é€æ¶ˆæ¯çš„æµè§ˆå™¨ä¹‹å¤–çš„å…¨éƒ¨æµè§ˆå™¨
    socket.on('push message', function (data) {
      $('form').before('<p>' + data + '</p>');
    });
    function keydown() {
      //è¡¨å•æäº¤å‘é€ä¿¡æ¯ç»™SocketIOæœåŠ¡å™¨,æœåŠ¡å™¨ç«¯ç›‘å¬messageäº‹ä»¶å³å¯è·å–åˆ°ä¿¡æ¯.
      if (!message.value) {
        alert('æ¶ˆæ¯ä¸èƒ½ä¸ºç©ºï¼');
        message.focus();
        return;
      } else {
        socket.emit('message', message.value);
        message.value = '';
        message.focus();
      }

      return false;
    }
    // function clickFun() {
    //   $.ajax({
    //     type: 'get',
    //     url: 'http://localhost:3001/123',
    //     success: function (data) {
    //       console.log(data, '1');
    //     },
    //     error: function (err) {
    //       console.log(err);
    //     },
    //   });
    // }
    // $(function () {
    //   //getè¯·æ±‚
    //   $.ajax({
    //     type: 'get',
    //     url: 'http://localhost:3001/123',
    //     success: function (data) {
    //       console.log(data, '1');
    //     },
    //     error: function (err) {
    //       console.log(err);
    //     },
    //   });
    //   //postè¯·æ±‚
    //   $.ajax({
    //     type: 'post',
    //     url: 'http://localhost:3001/wdltest',
    //     data: {
    //       name: 'wdl',
    //       pass: '123',
    //     },
    //     success: function (data) {
    //       console.log(data, '2');
    //     },
    //     error: function (err) {
    //       console.log(err);
    //     },
    //   });
    // });
  </script>
</html>
